--- a/river_endgame.py
+++ b/river_endgame.py
@@ -116,20 +116,20 @@
 		return up, uo
 
 
-	def _filtered_hands_for_cluster(self, clusters, cid, board_set):
-		hset = clusters.get(int(cid), [])
-		out = []
-		for h in hset:
-			if isinstance(h, str):
-				a, b = h.split()
-			else:
-				a, b = list(h)
-			if a == b:
-				continue
-			if (a in board_set) or (b in board_set):
-				continue
-			out.append(h if isinstance(h, str) else f"{a} {b}")
-		return out
+    def _filtered_hands_for_cluster(self, clusters, cid, board_set_upper):
+        hset = clusters.get(int(cid), [])
+        out = []
+        for h in hset:
+            if isinstance(h, str):
+                a, b = h.split()
+            else:
+                a, b = list(h)
+            if a == b:
+                continue
+            if (str(a).upper() in board_set_upper) or (str(b).upper() in board_set_upper):
+                continue
+            out.append(h if isinstance(h, str) else f"{a} {b}")
+        return out
 
 	def _ev_no_bucket(self, clusters, board_list_lower, board_set_upper, my_range, opp_range, wins_fn, resolved_pot):
 		ev_p_by_cluster = {}
